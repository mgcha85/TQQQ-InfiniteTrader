# TQQQ Infinite Trader (Strategy V2)

**심플강력 전략 v2 (월 1회 리밸런싱) 자동화 시스템**

한국투자증권 KIS API를 활용한 자산배분 및 리밸런싱 자동화 웹 애플리케이션입니다.

---

## 📋 목차

1. [프로젝트 개요](#프로젝트-개요)
2. [전략 설명 (V2)](#전략-설명-v2)
3. [기술 스택](#기술-스택)
4. [설치 및 실행](#설치-및-실행)
5. [환경 변수 설정](#환경-변수-설정)
6. [API 테스트](#api-테스트)

---

## 프로젝트 개요

기존 무한매수법에서 **월 1회 리밸런싱 전략**으로 변경되었습니다.  
매월 26일, 정해진 비중대로 자산을 매수/매도하여 리밸런싱을 수행합니다.

### 핵심 기능
- ✅ **월 1회 자동 리밸런싱** (매월 26일)
- ✅ **MA 130일선 로직 적용** (하락 추세 시 비중 축소)
- ✅ **2연타 Kill Switch** (PFIX/TMF 상호 스위칭)
- ✅ **예상 세금 계산** (양도세 22% 추정)
- ✅ **웹 대시보드** (프리뷰 및 수동 실행 지원)

---

## 전략 설명 (V2)

**"심플강력 전략 v2"**를 기반으로 합니다.

### 1. 기본 자산 배분
| 종목 | 티커 | 목표 비중 | 비율 |
|------|------|-----------|------|
| 미국 기술주 레버리지 | **TQQQ** | 50% | 5 |
| 금리 헷지 | **PFIX** | 15% | 1.5 |
| 배당 성장 | **SCHD** | 20% | 2 |
| 장기 채권 레버리지 | **TMF** | 15% | 1.5 |

### 2. 동적 비중 조절 (MA 130)
각 자산별로 130일 이동평균선(MA 130)을 기준으로 비중을 조절합니다.

1. **가격 < 130일선**: 비중 **50% 감산**
2. **130일선 하락 추세** (어제보다 하락): 비중 **50% 추가 감산**
   - 두 조건 모두 만족 시 비중은 원래의 25%가 됨 (0.5 * 0.5)

### 3. Kill Switch (PFIX ↔ TMF)
PFIX와 TMF에만 적용되는 특수 규칙입니다.

- **조건**: 위 1, 2번 조건(감산)을 **모두** 만족할 경우 (2연타)
- **행동**: 해당 자산의 비중을 **0% (전량 매도)**로 설정
- **스위칭**:
  - **TMF**가 Kill 되면 → **PFIX** 비중 2배
  - **PFIX**가 Kill 되면 → **TMF** 비중 2배

### 4. 리밸런싱 실행
- **매월 26일** 실행 (휴일인 경우 스케줄러 정책 따름)
- **Equity 계산**: (보유 주식 평가금 + 예수금)
- 목표 금액과 현재 금액의 차이만큼 매수(Buy) 또는 매도(Sell) 진행

---

## 설치 및 실행

### 사전 요구사항
- Docker & Docker Compose 설치
- 한국투자증권 KIS API 계정 (해외주식 권한 필수)

### 1. 프로젝트 클론 & 설정
```bash
git clone <repository-url>
cd TQQQ-InfiniteTrader
cp .env.example .env
nano .env  # KIS API 정보 입력
```

### 2. Docker 실행
```bash
docker-compose up -d --build
```

### 3. 접속
- **대시보드**: http://localhost:8081
- **백엔드 API**: http://localhost:8082

---

## 환경 변수 설정

| 변수명 | 설명 | 기본값/예시 |
|--------|------|-------------|
| `KIS_APP_KEY` | 앱 키 | (필수) |
| `KIS_APP_SECRET` | 시크릿 키 | (필수) |
| `KIS_ACCOUNT_NUM` | 계좌번호 (8자리+2자리) | `1234567801` |
| `KIS_BASE_URL` | API 주소 | 실전: `https://openapi.koreainvestment.com:9443` |
| `SCHEDULE_TIME` | 리밸런싱 실행 시간 (매월 26일) | `15:50` (ET 기준) |

---

## API 테스트

### 리밸런싱 프리뷰
```bash
curl http://localhost:8081/api/rebalance/preview | jq
```

### 리밸런싱 실행 (Dry Run)
```bash
curl -X POST "http://localhost:8081/api/rebalance/execute?dry_run=true"
```

### 리밸런싱 실행 (실전)
```bash
curl -X POST "http://localhost:8081/api/rebalance/execute?dry_run=false"
```
